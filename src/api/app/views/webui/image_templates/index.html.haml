
.grid_16
  %h1
    Choose a base template

  %fieldset.templateslist
    - first = nil
    - @projects.each do |project|
      %dl.templateslist
        %dt
          = link_to(title_or_name(project), project_show_path(project))
        - project.packages.each do |template|
          %label
            %input{ name: 'image', type: 'radio', class: 'hidden', "data-project": project, "data-package": template, checked: first ? nil : true }
            - first = template
            %dd
              %span.form-radio
              - if template.has_icon?
                %img{ alt: template.title, src: template.source_path('_icon') }
              - else
                = sprite_tag('drive-optical-48')
              %span.group
                %span.name.break-words
                  = link_to(title_or_name(template), package_show_path(project: project, package: template))
                %span.description.grey.break-words
                  = template.description
        - if project.packages.empty?
          %p
            There are currently no base image templates available for project <strong>#{title_or_name(project)}</strong>.
  - if @projects.empty?
    %p
      There are no templates yet, sorry.
  - else
    - if first
      .templates_form
        = form_tag({ controller: :package, :action => :branch, project: "placeholder", package: "placeholder"}, :method => :post, id: "appliance_form") do
          = label_tag(:target_package, 'Name your appliance')
          = text_field_tag(:target_package, first)
          = submit_tag('Create appliance', class: "create_appliance")
  
:javascript
  $('#target_package').on("input", function(e){
    $(".create_appliance").attr('disabled', (this.value == ""));
  });

  $(".create_appliance").on("click", function(e){
    e.preventDefault();
    var checked_element = $("input[name=image]:checked");
    var url = '/package/branch/' + checked_element.attr('data-project') + '/' + checked_element.attr('data-package');    
    $('#appliance_form').attr('action', url).submit();
  });
